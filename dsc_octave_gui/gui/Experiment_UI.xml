<?xml version="1.0" encoding="UTF-8"?>
<dialog Color="[0.941 0.941 0.941]" HPosition="center" Name="Experiment_UI" Position="[0 720 1280 720]" Resize="off" VPosition="center" windowStyle="normal">
    <GlobalSrc>%
% The source code writed here will be executed when
% windows load. Work like 'onLoad' event of other languages.
%

global app;
app = dlg;

pkg load instrument-control

% Initialize the struct to prevent errors
Data = struct('Kp', 0, 'Ki', 0, 'Kd', 0, ...
    'startTemp', 0, 'endTemp', 0, 'rampUpRate', 0, ...
    'holdTime', 0, 'startDateTime', datestr(clock()));

dlg.Data = Data;

%set(dlg.SerialPortComboBox, 'value', '');

dlg = initializeSerialPort(dlg);

% Set title and labels for plot
title(dlg.Main_Plot, 'Temperature vs. Time');
xlabel(dlg.Main_Plot, 'Time (sec)');
ylabel(dlg.Main_Plot, 'Temperature (C)');

dlg = setIdleUI(dlg);

% DEBUG
elapsedTimeArray = [0, 1];
targetTempArray = [0, 0];
refTempArray = [0, 1];
sampTempArray = [0, -1];

dlg = refreshLivePlot (dlg, elapsedTimeArray, targetTempArray, refTempArray, sampTempArray);

Experiment_UI = dlg;
</GlobalSrc>
    <uiControl class="imgCtrl" FontAngle="normal" FontName="Arial" FontSize="10" FontWeight="normal" Name="Main_Plot" Position="[240 40 820 600]"/>
    <uiControl class="buttonCtrl" BackgroundColor="[0.941 0.941 0.941]" FontAngle="normal" FontName="Arial" FontSize="10" FontWeight="normal" ForegroundColor="[0.000 0.000 0.000]" GenerateCallBack="true" Name="StartExperimentButton" Position="[10 5 180 44]" String="Start Experiment" TooltipString="">% This code will be executed when user click the button control.
% As default, all events are deactivated, to activate must set the
% propertie 'generateCallback' from the properties editor

dlg = struct(Experiment_UI);

set(dlg.StartExperimentButton, 'enable', 'off');

startExperiment(dlg);
</uiControl>
    <uiControl class="buttonCtrl" BackgroundColor="[0.941 0.941 0.941]" FontAngle="normal" FontName="Arial" FontSize="10" FontWeight="normal" ForegroundColor="[0.000 0.000 0.000]" GenerateCallBack="true" Name="StopExperimentButton" Position="[10 55 180 44]" String="Stop Experiment" TooltipString="">% This code will be executed when user click the button control.
% As default, all events are deactivated, to activate must set the
% propertie 'generateCallback' from the properties editor

set(Experiment_UI.StopExperimentButton, 'enable', 'off');

write(Experiment_UI.Arduino, 'x', 'char');
</uiControl>
    <uiControl class="buttonCtrl" BackgroundColor="[0.941 0.941 0.941]" FontAngle="normal" FontName="Arial" FontSize="10" FontWeight="normal" ForegroundColor="[0.000 0.000 0.000]" GenerateCallBack="true" Name="LoadConfigFileButton" Position="[10 105 180 44]" String="Load Config File" TooltipString="">% This code will be executed when user click the button control.
% As default, all events are deactivated, to activate must set the
% propertie 'generateCallback' from the properties editor

set(Experiment_UI.LoadConfigFileButton, 'enable', 'off');

loadConfigFile(Experiment_UI);

set(Experiment_UI.LoadConfigFileButton, 'enable', 'on');
</uiControl>
    <uiControl class="buttonCtrl" BackgroundColor="[0.941 0.941 0.941]" FontAngle="normal" FontName="Arial" FontSize="10" FontWeight="normal" ForegroundColor="[0.000 0.000 0.000]" GenerateCallBack="true" Name="SyncToArduinoButton" Position="[10 155 180 44]" String="Sync to Arduino" TooltipString="">% This code will be executed when user click the button control.
% As default, all events are deactivated, to activate must set the
% propertie 'generateCallback' from the properties editor

set(Experiment_UI.SyncToArduinoButton, 'enable', 'off');

% Create and display the progress bar
Experiment_UI.SharedProgressDlg = updateProgressDlg(Experiment_UI, 0, 'Communicating with Arduino...');

sendPIDGains(Experiment_UI, 1/5);
receivePIDGains(Experiment_UI, 2/5);

sendControlParameters(Experiment_UI, 3/5);
receiveControlParameters(Experiment_UI, 4/5);

Experiment_UI.SharedProgressDlg = updateProgressDlg(Experiment_UI, 5/5, 'Finished communicating with Arduino.');

% Close the progress bar
Experiment_UI = closeProgressDlg(Experiment_UI);

set(Experiment_UI.SyncToArduinoButton, 'enable', 'on');
</uiControl>
    <uiControl class="cmbCtrl" BackgroundColor="[0.941 0.941 0.941]" FontAngle="normal" FontName="Arial" FontSize="10" FontWeight="normal" ForegroundColor="[0.000 0.000 0.000]" GenerateCallBack="false" Name="SerialPortComboBox" Position="[115 600 70 25]" String="" TooltipString=""/>
    <uiControl class="textCtrl" BackgroundColor="[0.941 0.941 0.941]" FontAngle="normal" FontName="Arial" FontSize="10" FontWeight="normal" ForegroundColor="[0.000 0.000 0.000]" GenerateCallBack="false" HorizontalAlignment="left" isAutoSize="true" Name="Serial_Port_Label" Position="[15 605 61 16]" String="Serial Port" TooltipString=""/>
    <uiControl class="buttonCtrl" BackgroundColor="[0.941 0.941 0.941]" FontAngle="normal" FontName="Arial" FontSize="10" FontWeight="normal" ForegroundColor="[0.000 0.000 0.000]" GenerateCallBack="true" Name="SetSerialPortButton" Position="[10 630 180 44]" String="Set Serial Port" TooltipString="">% This code will be executed when user click the button control.
% As default, all events are deactivated, to activate must set the
% propertie 'generateCallback' from the properties editor

set(Experiment_UI.SetSerialPortButton, 'enable', 'off');

Experiment_UI.SerialPort = get(Experiment_UI.SerialPortComboBox, &quot;string&quot;){get (Experiment_UI.SerialPortComboBox, &quot;value&quot;)};

set(Experiment_UI.SetSerialPortButton, 'enable', 'on');
</uiControl>
    <uiControl class="groupPanel" BackgroundColor="[0.863 0.863 0.863]" BorderWidth="1" FontAngle="normal" FontName="Arial" FontSize="10" FontWeight="normal" ForegroundColor="[0.000 0.000 0.000]" Name="GroupPanel_1" Position="[10 220 180 145]" Title="Experiment Parameters" TitlePosition="lefttop">
        <ContainerSrc/>
        <uiControl class="textCtrl" BackgroundColor="[0.941 0.941 0.941]" FontAngle="normal" FontName="Arial" FontSize="10" FontWeight="normal" ForegroundColor="[0.000 0.000 0.000]" GenerateCallBack="false" HorizontalAlignment="left" isAutoSize="true" Name="Start_Temp_Label" Position="[10 25 84 16]" String="Start Temp (C)" TooltipString=""/>
        <uiControl class="editCtrl" BackgroundColor="[1.000 1.000 1.000]" FontAngle="normal" FontName="Arial" FontSize="10" FontWeight="normal" ForegroundColor="[0.000 0.000 0.000]" GenerateCallBack="false" HorizontalAlignment="left" Name="StartTempEditField" Position="[110 25 60 22]" String="0" TooltipString="">% This code will be executed when the control lost focus and text has
% been changed or when press the &quot;enter&quot; key.
% As default, all events are deactivated, to activate must set the
% propertie 'have callback' from the properties editor</uiControl>
        <uiControl class="textCtrl" BackgroundColor="[0.941 0.941 0.941]" FontAngle="normal" FontName="Arial" FontSize="10" FontWeight="normal" ForegroundColor="[0.000 0.000 0.000]" GenerateCallBack="false" HorizontalAlignment="left" isAutoSize="true" Name="End_Temp_Label" Position="[10 55 79 16]" String="End Temp (C)" TooltipString=""/>
        <uiControl class="editCtrl" BackgroundColor="[1.000 1.000 1.000]" FontAngle="normal" FontName="Arial" FontSize="10" FontWeight="normal" ForegroundColor="[0.000 0.000 0.000]" GenerateCallBack="false" HorizontalAlignment="left" Name="EndTempEditField" Position="[110 55 60 22]" String="0" TooltipString="">% This code will be executed when the control lost focus and text has
% been changed or when press the &quot;enter&quot; key.
% As default, all events are deactivated, to activate must set the
% propertie 'have callback' from the properties editor</uiControl>
        <uiControl class="textCtrl" BackgroundColor="[0.941 0.941 0.941]" FontAngle="normal" FontName="Arial" FontSize="10" FontWeight="normal" ForegroundColor="[0.000 0.000 0.000]" GenerateCallBack="false" HorizontalAlignment="left" isAutoSize="true" Name="Rate_Label" Position="[10 85 73 16]" String="Rate (C/min)" TooltipString=""/>
        <uiControl class="textCtrl" BackgroundColor="[0.941 0.941 0.941]" FontAngle="normal" FontName="Arial" FontSize="10" FontWeight="normal" ForegroundColor="[0.000 0.000 0.000]" GenerateCallBack="false" HorizontalAlignment="left" isAutoSize="true" Name="Hold_Time_Label" Position="[10 115 91 16]" String="Hold Time (sec)" TooltipString=""/>
        <uiControl class="editCtrl" BackgroundColor="[1.000 1.000 1.000]" FontAngle="normal" FontName="Arial" FontSize="10" FontWeight="normal" ForegroundColor="[0.000 0.000 0.000]" GenerateCallBack="false" HorizontalAlignment="left" Name="RateEditField" Position="[110 85 60 22]" String="0" TooltipString="">% This code will be executed when the control lost focus and text has
% been changed or when press the &quot;enter&quot; key.
% As default, all events are deactivated, to activate must set the
% propertie 'have callback' from the properties editor</uiControl>
        <uiControl class="editCtrl" BackgroundColor="[1.000 1.000 1.000]" FontAngle="normal" FontName="Arial" FontSize="10" FontWeight="normal" ForegroundColor="[0.000 0.000 0.000]" GenerateCallBack="false" HorizontalAlignment="left" Name="HoldTimeEditField" Position="[110 115 60 22]" String="0" TooltipString="">% This code will be executed when the control lost focus and text has
% been changed or when press the &quot;enter&quot; key.
% As default, all events are deactivated, to activate must set the
% propertie 'have callback' from the properties editor</uiControl>
    </uiControl>
    <uiControl class="editCtrl" BackgroundColor="[1.000 1.000 1.000]" FontAngle="normal" FontName="Arial" FontSize="10" FontWeight="normal" ForegroundColor="[0.000 0.000 0.000]" GenerateCallBack="false" HorizontalAlignment="left" Name="ElapsedTimesecEditField" Position="[1195 15 60 22]" String="0.00" TooltipString="">% This code will be executed when the control lost focus and text has
% been changed or when press the &quot;enter&quot; key.
% As default, all events are deactivated, to activate must set the
% propertie 'have callback' from the properties editor</uiControl>
    <uiControl class="editCtrl" BackgroundColor="[1.000 1.000 1.000]" FontAngle="normal" FontName="Arial" FontSize="10" FontWeight="normal" ForegroundColor="[0.000 0.000 0.000]" GenerateCallBack="false" HorizontalAlignment="left" Name="TargetTempCEditField" Position="[1195 50 60 22]" String="0.00" TooltipString="">% This code will be executed when the control lost focus and text has
% been changed or when press the &quot;enter&quot; key.
% As default, all events are deactivated, to activate must set the
% propertie 'have callback' from the properties editor</uiControl>
    <uiControl class="groupPanel" BackgroundColor="[0.863 0.863 0.863]" BorderWidth="1" FontAngle="normal" FontName="Arial" FontSize="10" FontWeight="normal" ForegroundColor="[0.000 0.000 0.000]" Name="GroupPanel_2" Position="[1075 100 180 115]" Title="Reference Sample Live Data" TitlePosition="lefttop">
        <ContainerSrc/>
        <uiControl class="editCtrl" BackgroundColor="[1.000 1.000 1.000]" FontAngle="normal" FontName="Arial" FontSize="10" FontWeight="normal" ForegroundColor="[0.000 0.000 0.000]" GenerateCallBack="false" HorizontalAlignment="left" Name="TemperatureCEditField" Position="[110 25 60 22]" String="0.00" TooltipString="">% This code will be executed when the control lost focus and text has
% been changed or when press the &quot;enter&quot; key.
% As default, all events are deactivated, to activate must set the
% propertie 'have callback' from the properties editor</uiControl>
        <uiControl class="editCtrl" BackgroundColor="[1.000 1.000 1.000]" FontAngle="normal" FontName="Arial" FontSize="10" FontWeight="normal" ForegroundColor="[0.000 0.000 0.000]" GenerateCallBack="false" HorizontalAlignment="left" Name="CurrentmAEditField" Position="[110 55 60 22]" String="0.00" TooltipString="">% This code will be executed when the control lost focus and text has
% been changed or when press the &quot;enter&quot; key.
% As default, all events are deactivated, to activate must set the
% propertie 'have callback' from the properties editor</uiControl>
        <uiControl class="editCtrl" BackgroundColor="[1.000 1.000 1.000]" FontAngle="normal" FontName="Arial" FontSize="10" FontWeight="normal" ForegroundColor="[0.000 0.000 0.000]" GenerateCallBack="false" HorizontalAlignment="left" Name="PWMDutyCycleEditField" Position="[110 85 60 22]" String="0.00" TooltipString="">% This code will be executed when the control lost focus and text has
% been changed or when press the &quot;enter&quot; key.
% As default, all events are deactivated, to activate must set the
% propertie 'have callback' from the properties editor</uiControl>
        <uiControl class="textCtrl" BackgroundColor="[0.941 0.941 0.941]" FontAngle="normal" FontName="Arial" FontSize="10" FontWeight="normal" ForegroundColor="[0.000 0.000 0.000]" GenerateCallBack="false" HorizontalAlignment="left" isAutoSize="true" Name="Ref_Temp_Label" Position="[10 25 92 16]" String="Temperature (C)" TooltipString=""/>
        <uiControl class="textCtrl" BackgroundColor="[0.941 0.941 0.941]" FontAngle="normal" FontName="Arial" FontSize="10" FontWeight="normal" ForegroundColor="[0.000 0.000 0.000]" GenerateCallBack="false" HorizontalAlignment="left" isAutoSize="true" Name="Ref_Cur_Label" Position="[10 55 74 16]" String="Current (mA)" TooltipString=""/>
        <uiControl class="textCtrl" BackgroundColor="[0.941 0.941 0.941]" FontAngle="normal" FontName="Arial" FontSize="10" FontWeight="normal" ForegroundColor="[0.000 0.000 0.000]" GenerateCallBack="false" HorizontalAlignment="left" isAutoSize="true" Name="Ref_PWM_Label" Position="[10 85 101 16]" String="PWM Duty Cycle" TooltipString=""/>
    </uiControl>
    <uiControl class="groupPanel" BackgroundColor="[0.863 0.863 0.863]" BorderWidth="1" FontAngle="normal" FontName="Arial" FontSize="10" FontWeight="normal" ForegroundColor="[0.000 0.000 0.000]" Name="GroupPanel_3" Position="[1075 250 180 115]" Title="Test Sample Live Data" TitlePosition="lefttop">
        <ContainerSrc/>
        <uiControl class="editCtrl" BackgroundColor="[1.000 1.000 1.000]" FontAngle="normal" FontName="Arial" FontSize="10" FontWeight="normal" ForegroundColor="[0.000 0.000 0.000]" GenerateCallBack="false" HorizontalAlignment="left" Name="TemperatureCEditField_2" Position="[110 25 60 22]" String="0.00" TooltipString="">% This code will be executed when the control lost focus and text has
% been changed or when press the &quot;enter&quot; key.
% As default, all events are deactivated, to activate must set the
% propertie 'have callback' from the properties editor</uiControl>
        <uiControl class="editCtrl" BackgroundColor="[1.000 1.000 1.000]" FontAngle="normal" FontName="Arial" FontSize="10" FontWeight="normal" ForegroundColor="[0.000 0.000 0.000]" GenerateCallBack="false" HorizontalAlignment="left" Name="CurrentmAEditField_2" Position="[110 55 60 22]" String="0.00" TooltipString="">% This code will be executed when the control lost focus and text has
% been changed or when press the &quot;enter&quot; key.
% As default, all events are deactivated, to activate must set the
% propertie 'have callback' from the properties editor</uiControl>
        <uiControl class="editCtrl" BackgroundColor="[1.000 1.000 1.000]" FontAngle="normal" FontName="Arial" FontSize="10" FontWeight="normal" ForegroundColor="[0.000 0.000 0.000]" GenerateCallBack="false" HorizontalAlignment="left" Name="PWMDutyCycleEditField_2" Position="[110 85 60 22]" String="0.00" TooltipString="">% This code will be executed when the control lost focus and text has
% been changed or when press the &quot;enter&quot; key.
% As default, all events are deactivated, to activate must set the
% propertie 'have callback' from the properties editor</uiControl>
        <uiControl class="textCtrl" BackgroundColor="[0.941 0.941 0.941]" FontAngle="normal" FontName="Arial" FontSize="10" FontWeight="normal" ForegroundColor="[0.000 0.000 0.000]" GenerateCallBack="false" HorizontalAlignment="left" isAutoSize="true" Name="Samp_Temp_Label" Position="[10 25 92 16]" String="Temperature (C)" TooltipString=""/>
        <uiControl class="textCtrl" BackgroundColor="[0.941 0.941 0.941]" FontAngle="normal" FontName="Arial" FontSize="10" FontWeight="normal" ForegroundColor="[0.000 0.000 0.000]" GenerateCallBack="false" HorizontalAlignment="left" isAutoSize="true" Name="Samp_Cur_Label" Position="[10 55 74 16]" String="Current (mA)" TooltipString=""/>
        <uiControl class="textCtrl" BackgroundColor="[0.941 0.941 0.941]" FontAngle="normal" FontName="Arial" FontSize="10" FontWeight="normal" ForegroundColor="[0.000 0.000 0.000]" GenerateCallBack="false" HorizontalAlignment="left" isAutoSize="true" Name="Samp_PWM_Label" Position="[10 85 101 16]" String="PWM Duty Cycle" TooltipString=""/>
    </uiControl>
    <uiControl class="textCtrl" BackgroundColor="[0.941 0.941 0.941]" FontAngle="normal" FontName="Arial" FontSize="10" FontWeight="normal" ForegroundColor="[0.000 0.000 0.000]" GenerateCallBack="false" HorizontalAlignment="left" isAutoSize="true" Name="Time_Label" Position="[1075 15 112 16]" String="Elapsed Time (sec)" TooltipString=""/>
    <uiControl class="textCtrl" BackgroundColor="[0.941 0.941 0.941]" FontAngle="normal" FontName="Arial" FontSize="10" FontWeight="normal" ForegroundColor="[0.000 0.000 0.000]" GenerateCallBack="false" HorizontalAlignment="left" isAutoSize="true" Name="Target_Temp_Label" Position="[1075 50 91 16]" String="Target Temp (C)" TooltipString=""/>
</dialog>
